<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Unofficial Bevy Cheat Book</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="cheatsheet/_index.html"><strong aria-hidden="true">1.</strong> Bevy Cheatsheet</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cheatsheet/release.html"><strong aria-hidden="true">1.1.</strong> for bevy 0.4</a></li><li class="chapter-item expanded "><a href="cheatsheet/master.html"><strong aria-hidden="true">1.2.</strong> for bevy git</a></li></ol></li><li class="chapter-item expanded "><a href="basics/_index.html"><strong aria-hidden="true">2.</strong> Bevy Basics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="basics/release.html"><strong aria-hidden="true">2.1.</strong> for bevy 0.4</a></li><li class="chapter-item expanded "><a href="basics/master.html"><strong aria-hidden="true">2.2.</strong> for bevy git</a></li></ol></li><li class="chapter-item expanded "><a href="patterns/_index.html"><strong aria-hidden="true">3.</strong> Advanced Patterns</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="patterns/event-broadcast.html"><strong aria-hidden="true">3.1.</strong> Event Broadcast</a></li><li class="chapter-item expanded "><a href="patterns/generic-systems.html"><strong aria-hidden="true">3.2.</strong> Generic Systems</a></li></ol></li><li class="chapter-item expanded "><a href="cookbook/_index.html"><strong aria-hidden="true">4.</strong> Bevy Cookbook</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="cookbook/input-handling.html"><strong aria-hidden="true">4.1.</strong> Input Handling</a></li><li class="chapter-item expanded "><a href="cookbook/quit.html"><strong aria-hidden="true">4.2.</strong> Quitting the App</a></li><li class="chapter-item expanded "><a href="cookbook/clear-color.html"><strong aria-hidden="true">4.3.</strong> Changing the Background Color</a></li><li class="chapter-item expanded "><a href="cookbook/print-framerate.html"><strong aria-hidden="true">4.4.</strong> Show Framerate in Console</a></li><li class="chapter-item expanded "><a href="cookbook/mouse-grab.html"><strong aria-hidden="true">4.5.</strong> Grabbing the Mouse</a></li><li class="chapter-item expanded "><a href="cookbook/cursor2world.html"><strong aria-hidden="true">4.6.</strong> Convert cursor to world coordinates</a></li><li class="chapter-item expanded "><a href="cookbook/custom-projection.html"><strong aria-hidden="true">4.7.</strong> Custom Camera Projection</a></li></ol></li><li class="chapter-item expanded "><a href="orphanage/_index.html"><strong aria-hidden="true">5.</strong> Orphanage</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="orphanage/pan-orbit-camera.html"><strong aria-hidden="true">5.1.</strong> Pan + Orbit Camera</a></li></ol></li><li class="chapter-item expanded "><a href="contributing.html">Contributing</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Unofficial Bevy Cheat Book</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#unofficial-bevy-cheat-book" id="unofficial-bevy-cheat-book">Unofficial Bevy Cheat Book</a></h1>
<p>Concise reference to programming in the <a href="https://github.com/bevyengine/bevy">Bevy game engine</a>.</p>
<p>Covers useful syntax, features, programming patterns, and solutions (&quot;recipes&quot;) for common game development tasks.</p>
<p>Designed to be easy to read, straight to the point, using simple language to focus on the important information.</p>
<p>The book has several sections:</p>
<ul>
<li><a href="./cheatsheet.html">Bevy Cheatsheet</a>: condensed one-page summary of common bevy syntax and features</li>
<li><a href="./basics.html">Bevy Basics</a>: brief one-page explanation of important concepts</li>
<li>Advanced Patterns: good practices for using bevy effectively</li>
<li>Bevy Cookbook: examples covering common game development problems</li>
<li>Orphanage: archive of unmaintained bevy code found out in the wild</li>
</ul>
<p>The book is not intended to be read in order. Jump to whatever is useful to you!</p>
<p><em><strong>Welcome! Hope this book serves you well!</strong></em></p>
<p>P.S: also check out the <a href="https://github.com/bevyengine/awesome-bevy">awesome-bevy</a> list,
for additional resources to help you on your bevy journey!</p>
<h2><a class="header" href="#maintenance" id="maintenance">Maintenance</a></h2>
<p>This version primarily covers Bevy release 0.4.</p>
<p>An attempt is made to also cover the git version of Bevy, where feasible.</p>
<p>The book is maintained on a best-effort basis. Help with maintaining and improving the book is welcome!</p>
<p>Development of the book happens on <a href="https://github.com/bevy-cheatbook/bevy-cheatbook">GitHub</a>.</p>
<p>See the <a href="./contributing.html">Contributing</a> section for advice!</p>
<h1><a class="header" href="#bevy-cheatsheet" id="bevy-cheatsheet">Bevy Cheatsheet</a></h1>
<p>One-page overview of common bevy features.</p>
<p>Concise listing of the syntax + important usage notes, no explanations.</p>
<p>Intended for people who are experienced with bevy and familiar with the concepts.</p>
<p>If you are new to bevy or need a refresher, see
<a href="cheatsheet/../cheatsheet/_index.html">Bevy Basics</a>
for brief explanations of each feature.</p>
<h2><a class="header" href="#versions" id="versions">Versions</a></h2>
<p><a href="cheatsheet/release.html">Click here for Bevy 0.4</a>.</p>
<p><a href="cheatsheet/master.html">Click here for Bevy git</a>.</p>
<h1><a class="header" href="#bevy-cheatsheet-for-bevy-04" id="bevy-cheatsheet-for-bevy-04">Bevy Cheatsheet (for bevy 0.4)</a></h1>
<p>One-page overview of common bevy features.</p>
<p>Concise listing of the syntax + important usage notes, no explanations.</p>
<p>Intended for people who are experienced with bevy and familiar with the concepts.</p>
<p>If you are new to bevy or need a refresher, see
<a href="cheatsheet/../cheatsheet/_index.html">Bevy Basics</a>
for brief explanations of each feature.</p>
<hr />
<h1><a class="header" href="#bevy-cheatsheet-for-bevy-git" id="bevy-cheatsheet-for-bevy-git">Bevy Cheatsheet (for bevy git)</a></h1>
<p>One-page overview of common bevy features.</p>
<p>Concise listing of the syntax + important usage notes, no explanations.</p>
<p>Intended for people who are experienced with bevy and familiar with the concepts.</p>
<p>If you are new to bevy or need a refresher, see
<a href="cheatsheet/../cheatsheet/_index.html">Bevy Basics</a>
for brief explanations of each feature.</p>
<hr />
<h1><a class="header" href="#bevy-basics" id="bevy-basics">Bevy Basics</a></h1>
<p>One-page overview of common bevy features.</p>
<p>Includes brief explanations and is structured in a logical order for learning.</p>
<p>Intended for people new to bevy.</p>
<p>If you are already familiar with the concepts, check out
<a href="basics/../cheatsheet/_index.html">Bevy Cheatsheet</a>
for an even more concise listing of just the syntax + important usage notes.</p>
<h2><a class="header" href="#versions-1" id="versions-1">Versions</a></h2>
<p><a href="basics/release.html">Click here for Bevy 0.4</a>.</p>
<p><a href="basics/master.html">Click here for Bevy git</a>.</p>
<h1><a class="header" href="#bevy-basics-for-bevy-04" id="bevy-basics-for-bevy-04">Bevy Basics (for bevy 0.4)</a></h1>
<p>One-page overview of common bevy features.</p>
<p>Includes brief explanations and is structured in a logical order for learning.</p>
<p>Intended for people new to bevy.</p>
<p>If you are already familiar with the concepts, check out
<a href="basics/../cheatsheet/_index.html">Bevy Cheatsheet</a>
for an even more concise listing of just the syntax + important usage notes.</p>
<hr />
<h1><a class="header" href="#bevy-basics-for-bevy-git" id="bevy-basics-for-bevy-git">Bevy Basics (for bevy git)</a></h1>
<p>One-page overview of common bevy features.</p>
<p>Includes brief explanations and is structured in a logical order for learning.</p>
<p>Intended for people new to bevy.</p>
<p>If you are already familiar with the concepts, check out
<a href="basics/../cheatsheet/_index.html">Bevy Cheatsheet</a>
for an even more concise listing of just the syntax + important usage notes.</p>
<hr />
<h1><a class="header" href="#bevy-advanced-patterns" id="bevy-advanced-patterns">Bevy Advanced Patterns</a></h1>
<p>This section of the book contains advice about general practices that help you use bevy effectively.</p>
<h1><a class="header" href="#event-broadcast" id="event-broadcast">Event Broadcast</a></h1>
<p><a href="patterns/../code_bevy_release/src/event-broadcast.rs">Click here to download the code from this page.</a></p>
<hr />
<p>Bevy events can be sent by any system and received by any system. This is very flexible and allows for interesting possibilities.</p>
<p>You can receive the same events type from multiple systems, but only selectively handle specific events relevant to each system.</p>
<hr />
<p>For example, imagine a multiplayer strategy game. You get messages from the server about game updates.</p>
<p>There are many different game mechanics, like unit movement, production, etc., and you can get updates about all of them.</p>
<p>It is convenient to have a single event type, so that you don't have to create boilerplate for new event types for every game mechanic.</p>
<pre><code class="language-rust no_run noplayground">/// Different things that can happen in the game
enum GameEvent {
    UnitSpawn {
        id: u32,
        position: Vec2,
    },
    UnitDestroyed {
        id: u32,
    },
    UnitMove {
        id: u32,
        position: Vec2,
    },
    PlayerDefeated {
        player_id: u32,
    },
    PlayerJoined {
        player_id: u32,
    }
    // etc ...
}
</code></pre>
<p>It also makes your networking system simple -- you can just send events of that type, when you get updates from the server:</p>
<pre><code class="language-rust no_run noplayground">fn net_system(
    mut net_state: ResMut&lt;MyNetProto&gt;,
    mut ev_game: ResMut&lt;Events&lt;GameEvent&gt;&gt;
) {
    while let Some(data) = net_state.recv_message() {
        // handle `data` somehow, and send events;
        // this is just a placeholder:
        ev_game.send(GameEvent::UnitMove {
            id: 7,
            position: Vec2::zero()
        });
        ev_game.send(GameEvent::PlayerDefeated {
            player_id: 1
        });
        ev_game.send(GameEvent::UnitDestroyed {
            id: 6,
        });
    }
}
</code></pre>
<p>Now, you can implement different game mechanics in separate systems, as they each likely need access to different things (resources/queries).</p>
<p>Each of those systems can receive the game events and handle only the ones it is interested in:</p>
<pre><code class="language-rust no_run noplayground">fn unit_move_system(
    ev_game: Res&lt;Events&lt;GameEvent&gt;&gt;,
    mut evr_game: Local&lt;EventReader&lt;GameEvent&gt;&gt;,
    q_units: Query&lt;&amp;mut Transform, With&lt;GameUnit&gt;&gt;,
) {
    for ev in evr_game.iter(&amp;ev_game) {
        match ev {
            GameEvent::UnitMove { id, position } =&gt; {
                // TODO: handle unit movement here
            }
            // we don't care about other events
            _ =&gt; {}
        }
    }
}

fn unit_manager_system(
    ev_game: Res&lt;Events&lt;GameEvent&gt;&gt;,
    mut evr_game: Local&lt;EventReader&lt;GameEvent&gt;&gt;,
    commands: &amp;mut Commands,
) {
    for ev in evr_game.iter(&amp;ev_game) {
        match ev {
            GameEvent::UnitSpawn { id, position } =&gt; {
                // TODO: handle unit spawn here
            }
            GameEvent::UnitDestroyed { id } =&gt; {
                // TODO: handle unit despawn here
            }
            // we don't care about other events
            _ =&gt; {}
        }
    }
}

fn session_manager_system(
    ev_game: Res&lt;Events&lt;GameEvent&gt;&gt;,
    mut evr_game: Local&lt;EventReader&lt;GameEvent&gt;&gt;,
    mut player_info: ResMut&lt;PlayerInfo&gt;,
) {
    for ev in evr_game.iter(&amp;ev_game) {
        match ev {
            GameEvent::PlayerJoined { player_id } =&gt; {
                // TODO: handle new player
            }
            GameEvent::PlayerDefeated { player_id } =&gt; {
                // TODO: handle player loss
            }
            // we don't care about other events
            _ =&gt; {}
        }
    }
}
</code></pre>
<h1><a class="header" href="#generic-systems" id="generic-systems">Generic Systems</a></h1>
<p><a href="patterns/../code_bevy_release/src/generic-systems.rs">Click here to download the code from this page.</a></p>
<hr />
<p>Bevy systems are just plain rust functions, which means they can be generic.</p>
<p>This is especially useful when combined with bevy states. You can do the same thing to different sets of entities depending on state.</p>
<hr />
<p>One use-case is for cleanup.</p>
<pre><code class="language-rust no_run noplayground">/// Marker components to group entities for cleanup
mod cleanup {
    pub struct LevelUnload;
    pub struct MenuExit;
}

fn cleanup_system&lt;T: Component&gt;(
    commands: &amp;mut Commands,
    q: Query&lt;Entity, With&lt;T&gt;&gt;,
) {
    for e in q.iter() {
        commands.despawn_recursive(e);
    }
}
</code></pre>
<p>Menu entities can be tagged with <code>cleanup::MenuExit</code>, entities from the game map can be tagged with <code>cleanup::LevelUnload</code>.</p>
<p>We can add the generic cleanup system to our state transitions, to take care of the respective entities:</p>
<pre><code class="language-rust no_run noplayground">#[derive(Debug, Clone)]
enum AppState {
    MainMenu,
    InGame,
}

/// Label for the main stage
static MAIN: &amp;str = &quot;MainStage&quot;;

fn main() {
    App::build()
        .add_plugins(DefaultPlugins)
        // add the state stage
        .add_resource(State::new(AppState::MainMenu))
        .add_stage_before(
            stage::UPDATE, MAIN,
            StateStage::&lt;AppState&gt;::default()
        )
        // add the cleanup systems
        .on_state_exit(
            MAIN, AppState::MainMenu,
            cleanup_system::&lt;cleanup::MenuExit&gt;.system()
        )
        .on_state_exit(
            MAIN, AppState::InGame,
            cleanup_system::&lt;cleanup::LevelUnload&gt;.system()
        )
        .run();
}
</code></pre>
<h1><a class="header" href="#bevy-cookbook" id="bevy-cookbook">Bevy Cookbook</a></h1>
<p>List of recipes for common problems and tasks in game development.</p>
<p>The recipes are written to only focus on the relevant information for the task at hand.</p>
<p>Only the relevant parts of the code are shown. Full example files are available and linked on the page of each recipe.</p>
<p>It is assumed that you are already familiar with Bevy programming. If not, check out <a href="cookbook/../basics/_index.html">Bevy Basics</a>.</p>
<h1><a class="header" href="#input-handling" id="input-handling">Input Handling</a></h1>
<p><a href="cookbook/../code_bevy_release/examples/input.rs">Click here for the full example code.</a></p>
<hr />
<p>Since bevy resources and events are global and accessible from any system, you
don't need to centralize your input handling code in one place. You can consume
any relevant inputs wherever you need them.</p>
<p>If you simply need to check the current state of specific keyboard keys or mouse buttons:</p>
<pre><code class="language-rust no_run noplayground">fn my_simple_system(keys: Res&lt;Input&lt;KeyCode&gt;&gt;, btns: Res&lt;Input&lt;MouseButton&gt;&gt;) {
    // Keyboard input
    if keys.pressed(KeyCode::Space) {
        // space is being held down
    }

    // Mouse buttons
    if btns.just_pressed(MouseButton::Left) {
        // a left click just happened
    }
}
</code></pre>
<p>For more powerful input handling, to detect all activity, use input events:</p>
<pre><code class="language-rust no_run noplayground">fn my_fancy_system(
    ev_keys: Res&lt;Events&lt;KeyboardInput&gt;&gt;,
    mut evr_keys: Local&lt;EventReader&lt;KeyboardInput&gt;&gt;,

    ev_cursor: Res&lt;Events&lt;CursorMoved&gt;&gt;,
    mut evr_cursor: Local&lt;EventReader&lt;CursorMoved&gt;&gt;,

    ev_motion: Res&lt;Events&lt;MouseMotion&gt;&gt;,
    mut evr_motion: Local&lt;EventReader&lt;MouseMotion&gt;&gt;,

    ev_mousebtn: Res&lt;Events&lt;MouseButtonInput&gt;&gt;,
    mut evr_mousebtn: Local&lt;EventReader&lt;MouseButtonInput&gt;&gt;,

    ev_scroll: Res&lt;Events&lt;MouseWheel&gt;&gt;,
    mut evr_scroll: Local&lt;EventReader&lt;MouseWheel&gt;&gt;,

    ev_touch: Res&lt;Events&lt;TouchInput&gt;&gt;,
    mut evr_touch: Local&lt;EventReader&lt;TouchInput&gt;&gt;,
) {
    // Keyboard input
    for ev in evr_keys.iter(&amp;ev_keys) {
        if ev.state.is_pressed() {
            eprintln!(&quot;Just pressed key: {:?}&quot;, ev.key_code);
        } else {
            eprintln!(&quot;Just released key: {:?}&quot;, ev.key_code);
        }
    }

    // Absolute cursor position (in window coordinates)
    for ev in evr_cursor.iter(&amp;ev_cursor) {
        eprintln!(&quot;Cursor at: {}&quot;, ev.position);
    }

    // Relative mouse motion
    for ev in evr_motion.iter(&amp;ev_motion) {
        eprintln!(&quot;Mouse moved {} pixels&quot;, ev.delta);
    }

    // Mouse buttons
    for ev in evr_mousebtn.iter(&amp;ev_mousebtn) {
        if ev.state.is_pressed() {
            eprintln!(&quot;Just pressed mouse button: {:?}&quot;, ev.button);
        } else {
            eprintln!(&quot;Just released mouse button: {:?}&quot;, ev.button);
        }
    }

    // scrolling (mouse wheel, touchpad, etc.)
    for ev in evr_scroll.iter(&amp;ev_scroll) {
        eprintln!(&quot;Scrolled vertically by {} and horizontally by {}.&quot;, ev.y, ev.x);
    }

    // touch input
    for ev in evr_touch.iter(&amp;ev_touch) {
        eprintln!(&quot;Touch {} in {:?} at {}.&quot;, ev.id, ev.phase, ev.position);
    }
}
</code></pre>
<h1><a class="header" href="#quitting-the-app" id="quitting-the-app">Quitting the App</a></h1>
<p><a href="cookbook/../code_bevy_release/examples/quit.rs">Click here for the full example code.</a></p>
<hr />
<p>To cleanly shut down bevy, send an <code>AppExit</code> event from any system:</p>
<pre><code class="language-rust no_run noplayground">use bevy::app::AppExit;

fn exit_system(mut exit: ResMut&lt;Events&lt;AppExit&gt;&gt;) {
    exit.send(AppExit);
}
</code></pre>
<p>For prototyping, bevy provides a system you can add, to exit on pressing the Esc key:</p>
<pre><code class="language-rust no_run noplayground">fn main() {
    App::build()
        .add_plugins(DefaultPlugins)
        .add_system(bevy::input::system::exit_on_esc_system.system())
        .run();
}
</code></pre>
<h1><a class="header" href="#changing-the-background-color" id="changing-the-background-color">Changing the Background Color</a></h1>
<p><a href="cookbook/../code_bevy_release/examples/clear-color.rs">Click here for the full example code.</a></p>
<hr />
<p>Use the <code>ClearColor</code> resource to choose the background color.</p>
<p>It must be added before the default plugins.</p>
<pre><code class="language-rust no_run noplayground">fn main() {
    App::build()
        .add_resource(ClearColor(Color::rgb(0.4, 0.4, 0.4)))
        .add_plugins(DefaultPlugins)
        .run();
}
</code></pre>
<h1><a class="header" href="#show-framerate-in-console" id="show-framerate-in-console">Show Framerate in Console</a></h1>
<p><a href="cookbook/../code_bevy_release/examples/print-framerate.rs">Click here for the full example code.</a></p>
<hr />
<p>You can use bevy's builtin diagnostics system to print framerate (FPS) to the console, for monitoring performance.</p>
<p><em>Note (git master)</em>: <code>PrintDiagnosticsPlugin</code> was renamed to <code>LogDiagnosticsPlugin</code>.</p>
<pre><code class="language-rust no_run noplayground">use bevy::diagnostic::{FrameTimeDiagnosticsPlugin, PrintDiagnosticsPlugin};

fn main() {
    App::build()
        .add_plugins(DefaultPlugins)
        .add_plugin(PrintDiagnosticsPlugin::default())
        .add_plugin(FrameTimeDiagnosticsPlugin::default())
        .add_system(PrintDiagnosticsPlugin::print_diagnostics_system.system())
        .run();
}
</code></pre>
<h1><a class="header" href="#grabbing-the-mouse" id="grabbing-the-mouse">Grabbing the Mouse</a></h1>
<p><a href="cookbook/../code_bevy_release/examples/mouse-grab.rs">Click here for the full example code.</a></p>
<hr />
<p>You can lock/release the mouse cursor using bevy's <a href="https://github.com/bevyengine/bevy/blob/master/examples/window/window_settings.rs">window settings API</a>.</p>
<p>Here is an example that locks and hides the cursor in the primary window on mouse click and releases it when pressing Esc:</p>
<pre><code class="language-rust no_run noplayground">fn cursor_grab_system(
    mut windows: ResMut&lt;Windows&gt;,
    btn: Res&lt;Input&lt;MouseButton&gt;&gt;,
    key: Res&lt;Input&lt;KeyCode&gt;&gt;,
) {
    let window = windows.get_primary_mut().unwrap();

    if btn.just_pressed(MouseButton::Left) {
        window.set_cursor_lock_mode(true);
        window.set_cursor_visibility(false);
    }

    if key.just_pressed(KeyCode::Escape) {
        window.set_cursor_lock_mode(false);
        window.set_cursor_visibility(true);
    }
}
</code></pre>
<h1><a class="header" href="#convert-cursor-to-world-coordinates" id="convert-cursor-to-world-coordinates">Convert cursor to world coordinates</a></h1>
<p><a href="cookbook/../code_bevy_release/examples/cursor2world.rs">Click here for the full example code.</a></p>
<hr />
<p>Bevy does not yet provide built-in functions to help with finding out what the cursor is pointing at.</p>
<h2><a class="header" href="#3d-games" id="3d-games">3D games</a></h2>
<p>There is a good (unofficial) plugin: <a href="https://github.com/aevyrie/bevy_mod_picking"><code>bevy_mod_picking</code></a>.</p>
<h2><a class="header" href="#2d-games" id="2d-games">2D games</a></h2>
<p>For a game using the default bevy 2d orthographic camera:</p>
<pre><code class="language-rust no_run noplayground">/// Used to help identify our main camera
struct MainCamera;

fn setup(commands: &amp;mut Commands) {
    let camera = Camera2dBundle::default();

    commands.spawn(camera)
        .with(MainCamera);
}

fn my_cursor_system(
    // events to get cursor position
    ev_cursor: Res&lt;Events&lt;CursorMoved&gt;&gt;,
    mut evr_cursor: Local&lt;EventReader&lt;CursorMoved&gt;&gt;,
    // need to get window dimensions
    wnds: Res&lt;Windows&gt;,
    // query to get camera transform
    q_camera: Query&lt;&amp;Transform, With&lt;MainCamera&gt;&gt;
) {
    // assuming there is exactly one main camera entity, so this is OK
    let camera_transform = q_camera.iter().next().unwrap();

    for ev in evr_cursor.iter(&amp;ev_cursor) {
        // get the size of the window that the event is for
        let wnd = wnds.get(ev.id).unwrap();
        let size = Vec2::new(wnd.width() as f32, wnd.height() as f32);

        // the default orthographic projection is in pixels from the center;
        // just undo the translation
        let p = ev.position - size / 2.0;

        // apply the camera transform
        let pos_wld = camera_transform.compute_matrix() * p.extend(0.0).extend(1.0);
        eprintln!(&quot;World coords: {}/{}&quot;, pos_wld.x, pos_wld.y);
    }
}
</code></pre>
<h1><a class="header" href="#custom-camera-projection" id="custom-camera-projection">Custom Camera Projection</a></h1>
<p><a href="cookbook/../code_bevy_release/examples/custom-projection.rs">Click here for the full example code.</a></p>
<hr />
<p>Camera with a custom projection (not using one of bevy's standard perspective or orthographic projections).</p>
<p>Here we implement a simple orthographic projection that maps <code>-1.0</code> to <code>1.0</code> to the vertical axis of the window,
and respects the window's aspect ratio for the horizontal axis:</p>
<pre><code class="language-rust no_run noplayground">use bevy::render::camera::{Camera, CameraProjection, DepthCalculation, VisibleEntities};

struct SimpleOrthoProjection {
    far: f32,
    aspect: f32,
}

impl CameraProjection for SimpleOrthoProjection {
    fn get_projection_matrix(&amp;self) -&gt; Mat4 {
        Mat4::orthographic_rh(
            -self.aspect, self.aspect, -1.0, 1.0, 0.0, self.far
        )
    }

    // what to do on window resize
    fn update(&amp;mut self, width: f32, height: f32) {
        self.aspect = width / height;
    }

    fn depth_calculation(&amp;self) -&gt; DepthCalculation {
        // for orthographic
        DepthCalculation::ZDifference

        // otherwise
        //DepthCalculation::Distance
    }
}

impl Default for SimpleOrthoProjection {
    fn default() -&gt; Self {
        Self { far: 1000.0, aspect: 1.0 }
    }
}

fn setup(commands: &amp;mut Commands) {
    // same components as bevy's Camera2dBundle,
    // but with our custom projection

    let projection = SimpleOrthoProjection::default();

    // Need to set the camera name to one of the bevy-internal magic constants,
    // depending on which camera we are implementing (2D, 3D, or UI).
    // Bevy uses this name to find the camera and configure the rendering.
    // Since this example is a 2d camera:

    let cam_name = bevy::render::render_graph::base::camera::CAMERA_2D;

    let mut camera = Camera::default();
    camera.name = Some(cam_name.to_string());

    commands.spawn((
        // position the camera like bevy would do by default for 2D:
        Transform::from_translation(Vec3::new(0.0, 0.0, projection.far - 0.1)),
        GlobalTransform::default(),
        VisibleEntities::default(),
        camera,
        projection,
    ));
}

fn main() {
    // need to add a bevy-internal camera system to update
    // the projection on window resizing

    use bevy::render::camera::camera_system;

    App::build()
        .add_plugins(DefaultPlugins)
        .add_startup_system(setup.system())
        .add_system_to_stage(
            bevy::app::stage::POST_UPDATE,
            camera_system::&lt;SimpleOrthoProjection&gt;.system(),
        )
        .run();
}
</code></pre>
<h1><a class="header" href="#orphanage" id="orphanage">Orphanage</a></h1>
<p>Collection of bevy code found out in the wild, which is not part of any project
and has no maintainer.</p>
<p>This code is not maintained. It probably does not compile on the latest bevy.</p>
<p>It is kept here for archival and visibility.</p>
<p>If you want to adopt and maintain any of this code, make a crate with it and
make a PR to replace the outdated code here with a link to your new crate.</p>
<h1><a class="header" href="#pan--orbit-camera" id="pan--orbit-camera">Pan + Orbit Camera</a></h1>
<p>Provide an intuitive camera that pans with left click or scrollwheel, and orbits with right click.</p>
<pre><code class="language-rust no_run noplayground">/// Tags an entity as capable of panning and orbiting.
struct PanOrbitCamera {
    /// The &quot;focus point&quot; to orbit around. It is automatically updated when panning the camera
    pub focus: Vec3,
}

impl Default for PanOrbitCamera {
    fn default() -&gt; Self {
        PanOrbitCamera {
            focus: Vec3::zero(),
        }
    }
}

/// Hold readers for events
#[derive(Default)]
struct InputState {
    pub reader_motion: EventReader&lt;MouseMotion&gt;,
    pub reader_scroll: EventReader&lt;MouseWheel&gt;,
}

/// Pan the camera with LHold or scrollwheel, orbit with rclick.
fn pan_orbit_camera(
    time: Res&lt;Time&gt;,
    windows: Res&lt;Windows&gt;,
    mut state: ResMut&lt;InputState&gt;,
    ev_motion: Res&lt;Events&lt;MouseMotion&gt;&gt;,
    mousebtn: Res&lt;Input&lt;MouseButton&gt;&gt;,
    ev_scroll: Res&lt;Events&lt;MouseWheel&gt;&gt;,
    mut query: Query&lt;(&amp;mut PanOrbitCamera, &amp;mut Transform)&gt;,
) {
    let mut translation = Vec2::zero();
    let mut rotation_move = Vec2::default();
    let mut scroll = 0.0;
    let dt = time.delta_seconds;

    if mousebtn.pressed(MouseButton::Right) {
        for ev in state.reader_motion.iter(&amp;ev_motion) {
            rotation_move += ev.delta;
        }
    } else if mousebtn.pressed(MouseButton::Left) {
        // Pan only if we're not rotating at the moment
        for ev in state.reader_motion.iter(&amp;ev_motion) {
            translation += ev.delta;
        }
    }

    for ev in state.reader_scroll.iter(&amp;ev_scroll) {
        scroll += ev.y;
    }

    // Either pan+scroll or arcball. We don't do both at once.
    for (mut camera, mut trans) in query.iter_mut() {
        if rotation_move.length_squared() &gt; 0.0 {
            let window = windows.get_primary().unwrap();
            let window_w = window.width() as f32;
            let window_h = window.height() as f32;

            // Link virtual sphere rotation relative to window to make it feel nicer
            let delta_x = rotation_move.x() / window_w * std::f32::consts::PI * 2.0;
            let delta_y = rotation_move.y() / window_h * std::f32::consts::PI;

            let delta_yaw = Quat::from_rotation_y(delta_x);
            let delta_pitch = Quat::from_rotation_x(delta_y);

            trans.translation =
                delta_yaw * delta_pitch * (trans.translation - camera.focus) + camera.focus;

            let look = Mat4::face_toward(trans.translation, camera.focus, Vec3::new(0.0, 1.0, 0.0));
            trans.rotation = look.to_scale_rotation_translation().1;
        } else {
            // The plane is x/y while z is &quot;up&quot;. Multiplying by dt allows for a constant pan rate
            let mut translation = Vec3::new(-translation.x() * dt, translation.y() * dt, 0.0);
            camera.focus += translation;
            *translation.z_mut() = -scroll;
            trans.translation += translation;
        }
    }
}

// Spawn a camera like this:

fn spawn_camera(mut commands: Commands) {
    commands.spawn((PanOrbitCamera::default(),))
        .with_bundle(Camera3dComponents {
            ..Default::default()
        });
}
</code></pre>
<h1><a class="header" href="#contributing" id="contributing">Contributing</a></h1>
<p>Any help with maintaining or improving the book is welcome! Contribute via <a href="https://github.com/bevy-cheatbook/bevy-cheatbook">GitHub</a>!</p>
<p>Feel free to submit PRs for anything you consider useful. I will review them with you, so we can edit as needed to bring them to the style and quality desired for this book.</p>
<p>Be civil. If you need a code of conduct, have a look at Bevy's.</p>
<h2><a class="header" href="#example-code" id="example-code">Example Code</a></h2>
<p>All code that uses Bevy APIs should live under <code>src/code_bevy_release</code> or <code>src/code_bevy_master</code>, depending on the version of Bevy used.</p>
<p>Cookbook recipes should be independent files under <code>examples</code>. Only embed the relevant parts into the book page, without unnecessary boilerplate. Link to the full example file at the top of the page.</p>
<p>Cheatsheet code lives in <code>src/cheatsheet.rs</code>.</p>
<p>Miscellaneous code in the book should live in <code>src/lib.rs</code>.</p>
<p>Always use mdbook anchor syntax to embed code, never line numbers.
<a href="https://rust-lang.github.io/mdBook/format/mdbook.html#including-portions-of-a-file">See here</a>.</p>
<h2><a class="header" href="#style-guidelines" id="style-guidelines">Style Guidelines</a></h2>
<p>Follow these guidelines to avoid the need for edits to your PRs and get them merged more easily:</p>
<ul>
<li>Reduce verbosity. Try to get the point across with simpler code and explanations.
<ul>
<li>&quot;Perfection is achieved not when there is nothing more to add, but when there is nothing more to remove.&quot;</li>
</ul>
</li>
<li>Avoid repeating information found elsewhere in the book.</li>
<li>Don't forget to point out gotchas, workarounds, and other relevant practical considerations.</li>
<li>Make it easy to read:
<ul>
<li>Try to cover all important information without wordy explanations.</li>
<li>Prefer simple English with short sentences.</li>
</ul>
</li>
<li>Use the most common/standard terminology and keywords, to make things easy to find.
<ul>
<li>Don't come up with new/extra terminology of your own.</li>
</ul>
</li>
<li>Avoid information overload
<ul>
<li>Cover advanced usage separately from the basics.</li>
<li>Prefer showing related features in a single code snippet (when not confusing). Avoid repeated/similar snippets.</li>
</ul>
</li>
<li>Avoid long lines of code, to keep it readable on small screens.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
