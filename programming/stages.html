<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Stages - Unofficial Bevy Cheat Book</title>
        <!-- Custom HTML head -->
<script async defer src="https://buttons.github.io/buttons.js"></script>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="../cheatsheet.html"><strong aria-hidden="true">1.</strong> Quick Reference (Alphabetical Index / Glossary)</a></li><li class="chapter-item expanded "><a href="../setup/_index.html"><strong aria-hidden="true">2.</strong> Bevy Setup Tips</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../setup/bevy-git.html"><strong aria-hidden="true">2.1.</strong> Using bleeding-edge Bevy (main)</a></li><li class="chapter-item expanded "><a href="../setup/editor.html"><strong aria-hidden="true">2.2.</strong> Text Editor / IDE</a></li><li class="chapter-item expanded "><a href="../setup/bevy-config.html"><strong aria-hidden="true">2.3.</strong> Customizing Bevy (features, modularity)</a></li></ol></li><li class="chapter-item expanded "><a href="../programming/_index.html"><strong aria-hidden="true">3.</strong> Bevy Programming</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../programming/_basics.html"><strong aria-hidden="true">3.1.</strong> Basics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../programming/ecs-intro.html"><strong aria-hidden="true">3.1.1.</strong> Intro to ECS</a></li><li class="chapter-item expanded "><a href="../programming/ec.html"><strong aria-hidden="true">3.1.2.</strong> Entities and Components</a></li><li class="chapter-item expanded "><a href="../programming/res.html"><strong aria-hidden="true">3.1.3.</strong> Resources</a></li><li class="chapter-item expanded "><a href="../programming/systems.html"><strong aria-hidden="true">3.1.4.</strong> Systems</a></li><li class="chapter-item expanded "><a href="../programming/queries.html"><strong aria-hidden="true">3.1.5.</strong> Queries</a></li><li class="chapter-item expanded "><a href="../programming/commands.html"><strong aria-hidden="true">3.1.6.</strong> Commands</a></li><li class="chapter-item expanded "><a href="../programming/events.html"><strong aria-hidden="true">3.1.7.</strong> Events</a></li><li class="chapter-item expanded "><a href="../programming/app-builder.html"><strong aria-hidden="true">3.1.8.</strong> App Builder (fn main)</a></li></ol></li><li class="chapter-item expanded "><a href="../programming/_next-steps.html"><strong aria-hidden="true">3.2.</strong> Next Steps</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../programming/local.html"><strong aria-hidden="true">3.2.1.</strong> Local Resources</a></li><li class="chapter-item expanded "><a href="../programming/plugins.html"><strong aria-hidden="true">3.2.2.</strong> Plugins</a></li><li class="chapter-item expanded "><a href="../programming/system-order.html"><strong aria-hidden="true">3.2.3.</strong> System Order of Execution</a></li><li class="chapter-item expanded "><a href="../programming/system-sets.html"><strong aria-hidden="true">3.2.4.</strong> System Sets</a></li><li class="chapter-item expanded "><a href="../programming/parent-child.html"><strong aria-hidden="true">3.2.5.</strong> Hierarchical Entities</a></li><li class="chapter-item expanded "><a href="../programming/change-detection.html"><strong aria-hidden="true">3.2.6.</strong> Change Detection</a></li><li class="chapter-item expanded "><a href="../programming/system-chaining.html"><strong aria-hidden="true">3.2.7.</strong> System Chaining</a></li><li class="chapter-item expanded "><a href="../programming/query-sets.html"><strong aria-hidden="true">3.2.8.</strong> Query Sets</a></li><li class="chapter-item expanded "><a href="../programming/states.html"><strong aria-hidden="true">3.2.9.</strong> States</a></li><li class="chapter-item expanded "><a href="../programming/run-criteria.html"><strong aria-hidden="true">3.2.10.</strong> Run Criteria</a></li><li class="chapter-item expanded "><a href="../programming/labels.html"><strong aria-hidden="true">3.2.11.</strong> Labels</a></li></ol></li><li class="chapter-item expanded "><a href="../programming/_advanced.html"><strong aria-hidden="true">3.3.</strong> Advanced</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../programming/stages.html" class="active"><strong aria-hidden="true">3.3.1.</strong> Stages</a></li><li class="chapter-item expanded "><a href="../programming/world-exclusive.html"><strong aria-hidden="true">3.3.2.</strong> Direct World/ECS Access</a></li><li class="chapter-item expanded "><a href="../programming/non-send.html"><strong aria-hidden="true">3.3.3.</strong> Non-Send Resources</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../features/_index.html"><strong aria-hidden="true">4.</strong> Bevy Features</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../features/transforms.html"><strong aria-hidden="true">4.1.</strong> Transforms and Coordinates</a></li><li class="chapter-item expanded "><a href="../features/assets.html"><strong aria-hidden="true">4.2.</strong> Assets</a></li><li class="chapter-item expanded "><a href="../features/input-handling.html"><strong aria-hidden="true">4.3.</strong> Input Handling</a></li><li class="chapter-item expanded "><a href="../features/camera.html"><strong aria-hidden="true">4.4.</strong> Cameras</a></li><li class="chapter-item expanded "><a href="../features/fixed-timestep.html"><strong aria-hidden="true">4.5.</strong> Fixed Timestep</a></li><li class="chapter-item expanded "><a href="../features/audio.html"><strong aria-hidden="true">4.6.</strong> Audio</a></li></ol></li><li class="chapter-item expanded "><a href="../pitfalls/_index.html"><strong aria-hidden="true">5.</strong> Common Pitfalls</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../pitfalls/performance.html"><strong aria-hidden="true">5.1.</strong> Slow Performance</a></li><li class="chapter-item expanded "><a href="../pitfalls/into-system.html"><strong aria-hidden="true">5.2.</strong> Error adding function as system</a></li><li class="chapter-item expanded "><a href="../pitfalls/build-errors.html"><strong aria-hidden="true">5.3.</strong> Strange Compilation Errors</a></li><li class="chapter-item expanded "><a href="../pitfalls/query-filter.html"><strong aria-hidden="true">5.4.</strong> Combining Query Filters</a></li><li class="chapter-item expanded "><a href="../pitfalls/split-borrows.html"><strong aria-hidden="true">5.5.</strong> Borrow multiple fields from struct</a></li><li class="chapter-item expanded "><a href="../pitfalls/frame-delay.html"><strong aria-hidden="true">5.6.</strong> Frame Delays / 1-frame-lag</a></li><li class="chapter-item expanded "><a href="../pitfalls/ui-camera.html"><strong aria-hidden="true">5.7.</strong> UI is not displaying</a></li><li class="chapter-item expanded "><a href="../pitfalls/2d-camera-z.html"><strong aria-hidden="true">5.8.</strong> Cannot see sprites in 2D</a></li><li class="chapter-item expanded "><a href="../pitfalls/file-formats.html"><strong aria-hidden="true">5.9.</strong> File Format Support</a></li><li class="chapter-item expanded "><a href="../pitfalls/time.html"><strong aria-hidden="true">5.10.</strong> Bevy Time vs. Rust/OS time</a></li><li class="chapter-item expanded "><a href="../pitfalls/ui-y-up.html"><strong aria-hidden="true">5.11.</strong> UI layout is inverted</a></li><li class="chapter-item expanded "><a href="../pitfalls/uv-coordinates.html"><strong aria-hidden="true">5.12.</strong> Textures/Images are flipped</a></li></ol></li><li class="chapter-item expanded "><a href="../patterns/_index.html"><strong aria-hidden="true">6.</strong> Advanced Patterns</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../patterns/generic-systems.html"><strong aria-hidden="true">6.1.</strong> Generic Systems</a></li><li class="chapter-item expanded "><a href="../patterns/manual-event-clear.html"><strong aria-hidden="true">6.2.</strong> Manual Event Clearing</a></li></ol></li><li class="chapter-item expanded "><a href="../cookbook/_index.html"><strong aria-hidden="true">7.</strong> Bevy Cookbook</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../cookbook/quit.html"><strong aria-hidden="true">7.1.</strong> Quit the App</a></li><li class="chapter-item expanded "><a href="../cookbook/clear-color.html"><strong aria-hidden="true">7.2.</strong> Change the Background Color</a></li><li class="chapter-item expanded "><a href="../cookbook/print-framerate.html"><strong aria-hidden="true">7.3.</strong> Show Framerate in Console</a></li><li class="chapter-item expanded "><a href="../cookbook/mouse-grab.html"><strong aria-hidden="true">7.4.</strong> Grab the Mouse</a></li><li class="chapter-item expanded "><a href="../cookbook/window-icon.html"><strong aria-hidden="true">7.5.</strong> Setting the Window Icon</a></li><li class="chapter-item expanded "><a href="../cookbook/assets-ready.html"><strong aria-hidden="true">7.6.</strong> Track Assets Loading</a></li><li class="chapter-item expanded "><a href="../cookbook/cursor2world.html"><strong aria-hidden="true">7.7.</strong> Convert cursor to world coordinates</a></li><li class="chapter-item expanded "><a href="../cookbook/custom-projection.html"><strong aria-hidden="true">7.8.</strong> Custom Camera Projection</a></li><li class="chapter-item expanded "><a href="../cookbook/pan-orbit-camera.html"><strong aria-hidden="true">7.9.</strong> Pan+Orbit Camera</a></li><li class="chapter-item expanded "><a href="../cookbook/print-resources.html"><strong aria-hidden="true">7.10.</strong> List All Resource Types</a></li></ol></li><li class="chapter-item expanded "><a href="../platforms/_index.html"><strong aria-hidden="true">8.</strong> Bevy on Different Platforms</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../platforms/linux.html"><strong aria-hidden="true">8.1.</strong> Linux Desktop</a></li><li class="chapter-item expanded "><a href="../platforms/macos.html"><strong aria-hidden="true">8.2.</strong> macOS Desktop</a></li><li class="chapter-item expanded "><a href="../platforms/windows.html"><strong aria-hidden="true">8.3.</strong> Windows Desktop</a></li><li class="chapter-item expanded "><a href="../platforms/wasm.html"><strong aria-hidden="true">8.4.</strong> Browser (WebAssembly)</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../platforms/wasm/wasm-pack.html"><strong aria-hidden="true">8.4.1.</strong> Setup (wasm-pack)</a></li><li class="chapter-item expanded "><a href="../platforms/wasm/cargo-make.html"><strong aria-hidden="true">8.4.2.</strong> Setup (Cargo Make)</a></li><li class="chapter-item expanded "><a href="../platforms/wasm/panic-console.html"><strong aria-hidden="true">8.4.3.</strong> Panic Messages</a></li><li class="chapter-item expanded "><a href="../platforms/wasm/rng.html"><strong aria-hidden="true">8.4.4.</strong> Random Number Generation</a></li><li class="chapter-item expanded "><a href="../platforms/wasm/size-opt.html"><strong aria-hidden="true">8.4.5.</strong> Optimize for Size</a></li><li class="chapter-item expanded "><a href="../platforms/wasm/gh-pages.html"><strong aria-hidden="true">8.4.6.</strong> Hosting on GitHub Pages</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../contributing.html">Contributing</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Unofficial Bevy Cheat Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="stages"><a class="header" href="#stages">Stages</a></h1>
<p>All systems to be run by Bevy are contained in stages. Every frame update,
Bevy executes each stage, in order. Within each stage, Bevy's scheduling
algorithm can run many systems in parallel, using multiple CPU cores for
good performance.</p>
<p>The boundaries between stages are effectively hard synchronization points.
They ensure that all systems of the previous stage have completed before any
systems of the next stage begin, and that there is a moment in time when no
systems are in-progress.</p>
<p>This makes it possible/safe to apply <a href="./commands.html"><code>Commands</code></a>. Any
operations performed by systems using <code>Commands</code> are applied at the end of
each stage.</p>
<p>Internally, Bevy has at least these built-in stages: <code>First</code>, <code>PreUpdate</code>,
<code>Update</code>, <code>PostUpdate</code>, <code>Last</code>.</p>
<p>(<a href="./labels.html">labeled</a> with <code>enum CoreStage</code>)</p>
<p>By default, when you add your systems, they are added to <code>CoreStage::Update</code>.</p>
<p>Bevy's internal systems are in the other stages, to ensure they are ordered
correctly relative to your game logic.</p>
<p>If you want to add your own systems to any of Bevy's internal stages, you
need to beware of potential unexpected interactions with Bevy's own internal
systems.  Remember: Bevy's internals are implemented using ordinary systems
and ECS, just like your own stuff!</p>
<p>You can add your own additional stages. For example, if we want our debug
systems to run after our game logic:</p>
<pre><code class="language-rust no_run noplayground">fn main() {
    // label for our debug stage
    static DEBUG: &amp;str = &quot;debug&quot;;

    App::build()
        .add_plugins(DefaultPlugins)

        // add DEBUG stage after Bevy's Update
        // also make it single-threaded
        .add_stage_after(CoreStage::Update, DEBUG, SystemStage::single_threaded())

        // systems are added to the `CoreStage::Update` stage by default
        .add_system(player_gather_xp.system())
        .add_system(player_take_damage.system())

        // add our debug systems
        .add_system_to_stage(DEBUG, debug_player_hp.system())
        .add_system_to_stage(DEBUG, debug_stats_change.system())
        .add_system_to_stage(DEBUG, debug_new_hostiles.system())

        .run();
}
</code></pre>
<p>If you need to manage when your systems run, relative to one another, it
is generally preferable to avoid using stages, and to use <a href="./system-order.html">explicit system
ordering</a> instead. Stages limit parallel execution and
the performance of your game.</p>
<p>However, stages can make it easier to organize things, when you really want
to be sure that all previous systems have completed. Stages are also the
only way to apply <code>Commands</code>.</p>
<p>If you have systems that need to rely on the actions that other systems
have performed by using <code>Commands</code>, and need to do so during the same frame,
placing those systems into separate stages is the only way to accomplish that.</p>
<p><a href="../pitfalls/frame-delay.html#commands">More information on avoiding frame delays / 1-frame-lag, when using <code>Commands</code>.</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../programming/_advanced.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../programming/world-exclusive.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../programming/_advanced.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../programming/world-exclusive.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
